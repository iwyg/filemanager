(function(a){a("collections/col_general",["underscore","backbone"],function(a,b){var c=b.Collection.extend({addSetting:function(a,b,c){this.settings=this.settings||{};if(this.settings[a]&&c!==!0)throw"setting "+a+"already defined";this.settings[a]=b;return this}});c.defaults={};return c})})(this.define),function(a,b){typeof a.define=="function"&&a.define.amd?a.define(["jquery"],b):b(a.jQuery)}(this,function(a,b){a.ajaxPrefilter(function(a,b,c){if(a.iframe)return"iframe"}),a.ajaxTransport("iframe",function(b,c,d){function j(){i.replaceWith(function(a){return h.get(a)}),e.remove(),f.attr("src","javascript:false;").remove()}var e=null,f=null,g="iframe-"+a.now(),h=a(b.files).filter(":file:enabled"),i=null;b.dataTypes.shift();if(h.length){e=a('<form enctype="multipart/form-data" method="post"></form>').hide().attr({action:b.url,target:g}),typeof b.data=="string"&&b.data.length>0&&a.error("data must not be serialized"),a.each(b.data||{},function(b,c){a.isPlainObject(c)&&(b=c.name,c=c.value),a('<input type="hidden">').attr({name:b,value:c}).appendTo(e)}),a('<input type="hidden" value="IFrame" name="X-Requested-With">').appendTo(e),i=h.after(function(b){return a(this).clone().prop("disabled",!0)}).next(),h.appendTo(e);return{send:function(b,c){f=a('<iframe src="javascript:false;" name="'+g+'" style="display:none"></iframe>'),f.bind("load",function(){f.unbind("load").bind("load",function(){var a=this.contentWindow?this.contentWindow.document:this.contentDocument?this.contentDocument:this.document,b=a.documentElement?a.documentElement:a.body,d=b.getElementsByTagName("textarea")[0],e=d?d.getAttribute("data-type"):null,f={html:b.innerHTML,text:e?d.value:b?b.textContent||b.innerText:null};j(),c(200,"OK",f,e?"Content-Type: "+e:null)}),e[0].submit()}),a("body").append(e,f)},abort:function(){f!==null&&(f.unbind("load").attr("src","javascript:false;"),j())}}}})}),function(a,b,c){var d={xhrFileUpload:!!a.XMLHttpRequestUpload&&!!a.FileReader,xhrFormDataFileUpload:!!a.FormData},e={cache:!1,type:"POST",processData:!1,contentType:!1},f=d.xhrFormDataFileUpload;b("modules/mod_async_upload",["jquery","underscore","backbone","plugins/jquery-iframe-transport/jquery-iframe-transport"],function(b,c,d){function o(){this.initialize.apply(this,arguments)}var g,h=function(a){var b=a.find("form"),c=b.length;a.get(0).nodeName.toLowerCase()!=="form"||!c?a=a.find("input, textarea, select"):c&&(a=b);return a.serializeArray()},i=function(){return f?function(d){var e=new a.FormData;c.each(d,function(d,f,g){d instanceof a.Blob?e.append(f+"[]",d,f.name):d instanceof b&&c.each(h(d),function(a){e.append(a.name,a.value)})});return e}:function(a){var b=h(a.context);b.push({name:"iframe",value:!0});return b}}(),j=function(a){var b=a.originalEvent,c=b.total||b.totalSize,d=b.loaded;this.trigger("progress",d,c)},k=function(){var a=b.ajaxSettings.xhr();a.upload&&b(a.upload).on("progress",c.bind(j,this));return a},l=function(){return f?function(b){if(!!b.file&&b.file instanceof a.Blob){!b.file.name&&b.file.fileName&&(b.file.name=b.file.fileName),!b.file.size&&b.file.fileSize&&(b.file.size=b.file.fileSize);return b}throw"no file found"}:function(a){return a}}(),m=function(a){return c.extend({url:this.settings.url,data:i(l(a)),xhr:c.bind(k,this)},g.defaults)},n=function(){return f?m:function(a){var b=a.form;a=m.call(this,a),a.files=b,a.iframe=!0,a.dataType="iframe json";return a}}();o.prototype.initialize=function(){},c.extend(o.prototype,d.Events),o.extend=d.Model.extend,g=o.extend({initialize:function(a){this.settings=c.extend(c.clone(g.defaults),a||{})},send:function(a){a=n.call(this,a);var c=b.ajax(a);return c}}),g.defaults=function(){return f?e:c.extend(e,{files:"",form:"",processData:!1})}(),g.isXHRFileUpload=f;return g})}(this,this.define),function(a){var b=1e3,c=Math.pow(b,2),d=Math.pow(b,3);a("modules/mod_byteconverter",[],function(){function h(a){return a<b?a+"":a<c?e(a)+" KB":a<d?f(a)+" MB":g(a)+" GB"}function g(b){return a(b,d)}function f(b){return a(b,c)}function e(c){return a(c,b)}function a(a,b){return(Math.round(a/b*1e5)/1e5).toFixed(2)}return h})}(this.define),function(a,b){a("collections/col_upload",["underscore","backbone","collections/col_general","modules/mod_async_upload","modules/mod_byteconverter"],function(a,c,d,e,f){function m(a){a===this&&this.trigger("destroyed",this)}function l(b){b.fail(a.bind(j,this)).done(a.bind(k,this));return b}function k(a,b){b==="success"&&this.trigger("success",this,a)}function j(a,b){b==="abort"&&this.trigger("cancled",this),b==="error"&&this.trigger("error",this,$.parseJSON(a.responseText))}var g,h,i;h=c.Model.extend({initialize:function(){this.collection.trigger("create",this),window._m=this,this.collection.on("remove",a.bind(m,this))},parse:function(a){},url:function(){return this.collection.url+"?field_id="+this.get("field_id")},defaults:{context:"",file:[],originalFiles:[],form:"",name:undefined,size:0,type:undefined,id:undefined,field_id:undefined},_createSendData:function(){return{file:this.get("file")}},_filter:function(b,c){var d=c.split(" "),e={};a.each(b,function(b,c){a.include(d,c)&&(e[c]=b)});return e},send:function(){var b=new e({url:this.url()});b.on("progress",a.bind(this._onProgress,this)),this._upload=l.call(this,b.send(this._filter(this.toJSON(),"file context form")))},_onProgress:function(a,b){this.trigger("progress",Math.floor(a/b*100))},_onSuccess:function(){}}),i=function(){function p(a){alert(a)}function o(a){!a.name&&a.fileName&&(a.name=a.fileName),!a.size&&a.fileSize&&(a.size=a.fileSize);return a}function n(a){c[this.cid].push(a),this.trigger("push")}function m(a){e[this.cid].push(a),this.trigger("push")}function l(b){var c=e[this.cid],d=a.indexOf(c,b);d>-1&&(c.splice(d,1),this.trigger("flush"))}function k(b){var d=c[this.cid],e=a.indexOf(d,b);e>-1&&(d.splice(e,1),this._uploads--,this.trigger("flush"))}function j(b){var c=this,d=[],e=a.toArray(b[0].files);a.each(e,function(h,j,k){var l=a.clone(c.model.prototype.defaults);g.call(c,h.type)?i.call(c,h.size)?(l.form=b,l.file=h,l.originalFiles=k,l.name=h.name||h.fileName,l.size=f(h.size||h.fileSize),l.type=h.type,l.id=a.uniqueId(),d.push(l)):(e[j]=null,e.splice(j,1),c.trigger("filesizeexceeds",h.name||h.fileName,h.size)):(e[j]=null,e.splice(j,1),c.trigger("invalidtype",h.name||h.fileName,h.type))});return d}function i(a){return parseInt(this.settings.max_file_size,10)<a?!1:!0}function g(a){var b="("+this.settings.allowed_types.join("|")+")",c;b=b.replace(/\/\*/g,"/.*"),c=new RegExp(b);return a.match(c)?!0:!1}var c={},e={};return d.extend({events:{error:"_onError"},initialize:function(){this.cid=this.cid||"c"+a.uniqueId(),e[this.cid]=[],c[this.cid]=[],this.on("add",a.bind(n,this)),this.on("remove",a.bind(k,this))},url:b.WEBSITE+"/symphony/extension/filemanager/upload/",model:h,addItem:function(a){var b=j.call(this,a);this.add(b)},removeItem:function(a){this.remove(a)},update:function(b,c){var d=this,e;a.isArray(c)?a.each(c,function(a){d.update(b,a)}):(e=this.get(b),e.set(c))},send:function(b){var c=this.get(b),d;c.on("success",a.bind(this.update,this)).on("success error cancled",a.bind(l,this)),d=c.send(),m.call(this,c),k.call(this,c);return c._upload},cancel:function(a){var b=this.get(a);if(b._upload&&!b._upload.isResolved()){b._upload.abort(),n.call(this,b);return!0}return!1},hasActiveUploads:function(){return!!e[this.cid].length},hasPendingUploads:function(){return!!c[this.cid].length}})}(),g=d.extend({constructors:{UploadList:i},addList:function(){var b=new i;a.each(this.settings,function(a,c){b.addSetting(c,a,!0)});return b},initialize:function(){this.settings=a.extend({},g.defaults)}}),g.defaults={field_id:null,allowed_types:["image/jpeg"]};return new g})}(this.define,this.Symphony),function(a,b){var c=Math.PI,d=c*2,e=c/2;b("modules/mod_animate_circle",["jquery","underscore"],function(a,b){function k(a){this.settings=b.extend(b.clone(k.defaults),a||{}),this.canvas=this.settings.canvas,this.ctx=this.canvas.getContext("2d"),this._begin=-e,this._cw=this.canvas.width,this._ch=this.canvas.height,this._last=[0],this._ao=jQuery({p:0}),this._calcColDiff(),this.ctx.arc(this._cw/2,this._ch/2,this._ch/2-this.settings.lineWidth,0,d,!1);var c=this._ch/2,f=c-this.settings.lineWidth;this._grad=this.ctx.createRadialGradient(c,c,f,c,c,c),j.call(this,[220,220,220]),this.ctx.beginPath(),this.ctx.lineWidth=this.settings.lineWidth,this.ctx.strokeStyle=this._grad,this.ctx.closePath(),this.ctx.fill(),this.ctx.arc(this._cw/2,this._ch/2,this._ch/2-this.settings.lineWidth/2,-e,100-e,!1),this.ctx.stroke(),this._imd=this.ctx.getImageData(0,0,this._cw,this._ch)}function j(a){var b=this._ch/2,c=b-this.settings.lineWidth;this._grad=this.ctx.createRadialGradient(b,b,c,b,b,b),this._grad.addColorStop(0,i(g(a,10))),this._grad.addColorStop(.3,i(a)),this._grad.addColorStop(.7,i(a)),this._grad.addColorStop(1,i(g(a,10)))}function i(a){var b=a.length>3?"rgba(":"rgb(";return b+a.join(",")+")"}function h(a,b){var c=a[0],d=a[1],e=a[2],g=f(b,c),h=f(b,d),i=f(b,e);return[g,h,i]}function g(a,b){var d=a[0],e=a[1],f=a[2],g=c(b,d),h=c(b,e),i=c(b,f);return[g,h,i]}function f(a,b){return Math.min(Math.round((b/255*100+a)/100*255),255)}function c(a,b){return Math.max(Math.round((b/255*100-a)/100*255),0)}k.prototype={_prop:function(a){return{p:a}},_complete:function(){},drawFullCircle:function(a){j.call(this,a),this.ctx.putImageData(this._imd,0,0),this.ctx.strokeStyle=this._grad,this.ctx.arc(this._cw/2,this._ch/2,this._ch/2-this.settings.lineWidth/2,-e,100-e,!1),this.ctx.stroke(),this.ctx.closePath()},clearAnimation:function(){this._ao.stop(),this._ao.dequeue()},animate:function(a){this._ao[0].p=this._last.pop()||0,this._ao.stop().animate(this._last.push(a)&&this._prop(a),{duration:this.settings.stepTime,step:b.bind(this._step,this),complete:b.bind(this._complete,this)})},_step:function(a){var b=d/100*a;this._draw(b,this._getCurrentColor(a))},_draw:function(a,b){if(a!==0&&a===this._begin||a>=d){this.clearAnimation();return!1}j.call(this,this._cCol),this.ctx.putImageData(this._imd,0,0),this.ctx.beginPath(),this.ctx.strokeStyle=this._grad,this.ctx.arc(this._cw/2,this._ch/2,this._ch/2-this.settings.lineWidth/2,-e,a-e,!1),this.ctx.stroke()},_calcColDiff:function(){var a=this.settings.startColor,b=this.settings.endColor;this._colDiff=a,this._cMatrix=[],this._cCol=[],this._cMatrix[0]=(b[0]-a[0])/100,this._cMatrix[1]=(b[1]-a[1])/100,this._cMatrix[2]=(b[2]-a[2])/100},_getCurrentColor:function(a){this._cCol[0]=Math.round(this._colDiff[0]+this._cMatrix[0]*a),this._cCol[1]=Math.round(this._colDiff[1]+this._cMatrix[1]*a),this._cCol[2]=Math.round(this._colDiff[2]+this._cMatrix[2]*a);return"rgb("+this._cCol.join(",")+")"},update:function(){}},k.defaults={canvas:document.createElement("canvas"),startColor:[89,123,198],endColor:[126,222,79],background:"rgb(250, 250, 250)",stepTime:250,lineWidth:5};return k})}(this,this.define),function(a,b){var c={file_size_exceeds:"{$item} exceeds allowed size",file_type_invalid:"{$item}: filetype invalid",file_exists:"file {$file} already exists",directory_exists:"directory {$file} already exists",directory_created:"Directory {$dir} successfully created in {$path}",invalid_destination:"invalid destination: {$dir}",confirm_file_deletion:"Are you shure you want to delete {$file}? This step cannot be undone.",confirm_directory_deletion:"Are you shure you want to delete {$dir}? {$dir2} contains {$dircount} directories and {$filecount} files that will be deleted. This step cannot be undone.",file_select_limit_exceed:"Can't select more than {$count} files",unsaved_changes:"There are unsaved changes. Do you really want to continue?"},d=[],e=/\{\$.*?\}/g;a("modules/mod_sysmessage",["jquery","underscore"],function(a,e){function g(b,c,e){e=typeof e=="boolean"?e:!0,this.type=!b&&c.status===400?"error":c.success?"success":b,this.msgObj=this.type==="success"?c.success:this.type==="error"?e?a.parseJSON(c.responseText).STATUS_ERROR.error:c.error:{},d.push(this.parseMessage()),this.displayMessage()}var f={};e.each(c,function(a,b){f[a]=!1}),b.Language.add(f),g.prototype={parseMessage:function(){return b.Language.get(this.msgObj.message,this.msgObj.context)},displayMessage:function(){var a=d.length>1?0:4e3,c=this;b.Message.fade("silence",10),b.Message.post(d.shift(),c.type),setTimeout(function(){setTimeout(function(){b.Message.clear(c.type)},300)},a)}},e.extend(g,c);return g})}(this.define,this.Symphony),define("text!templates/dirtree.tpl",[],function(){return'<ul id="dir-list-root"></ul>\n<input id="schema" type="hidden" name="set[schema]" value=""/>\n'}),define("text!templates/dirs.tpl",[],function(){return'<!--dir level <%= level %>">-->\n<% var droppable = (settings.allow_dir_move || settings.allow_file_move) ? \' droppable\' : \'\', draggable = settings.allow_dir_move ? \' draggable\' : \'\'%>\n\t<span class="dir-header<%=draggable%><%=droppable%>">\n\t\t<% if (settings.allow_dir_move && _parent) {%>\n\t\t<span class="ui-icon move" id=" del-<%= id %>"></span>\t\n\t\t<%}%>\n\t\t<span class="dir-toggle"></span>\n\t\t<span class="ui-icon"></span>\n\t\t<label class="dir-label text">\n\t\t\t<%= name %>\n\t\t</label>\n\t\t<% if (settings) { %>\t\n\t\t<span class="toolbar">\n\t\t\t<% if (settings.allow_dir_upload_files) {%>\n\t\t\t<span class="ui-icon upload"></span>\t\n\t\t\t<%}%>\n\t\t\t<% if (settings.allow_dir_create) {%>\n\t\t\t<span class="ui-icon create"></span>\t\n\t\t\t<%}%>\n\t\t\t<% if (settings.allow_dir_delete) {%>\n\t\t\t<span class="ui-icon delete" id="del-<%= id %>"></span>\t\n\t\t\t<%}%>\n\t\t</span>\n\t\t<%}%>\n\n\t</span>\n\t<ul id="sub-<%= id %>" class="dir sub-dir <% if (!!_parent) {%> sub-dir <%} %>">\n\t</ul>\n<!-- dir end -->\n'}),define("text!templates/newdir.tpl",[],function(){return'<li class="dir new-dir level-<%= level %>">\n<div class="row">\n\t<span class="dir-header">\n\t<div class="list-column-43">\n\t\t<div class="inner">\n\t\t<span class="dir-toggle"></span>\n\t\t\t<span class="ui-icon folder"></span>\n\t\t\t<input type="text" name="mkdir" placeholder="enter new directory name"/>\n\t\t\t<input type="hidden" name="in" value="<%= parent %>"/>\n\t\t\t<input type="hidden" name="type" value="create"/>\n\t</div>\n\t</div>\n\t<div class="list-column-4">\n\t\t<div class="inner">\n\t\t\t<span class="btn small add last">ok</span>\n\t\t\t<span class="btn small cancel last">cancel</span>\n\t\t</div>\n\t</div>\n\t</span>\n</div>\n</li>\n'}),define("text!templates/files.tpl",[],function(){return'<% var draggable = settings.allow_file_move ? \' draggable\' : \'\' %>\n<li class="<%= cssclass %><%= draggable %>" id="file-<%= id %>">\n\t<% if (settings.allow_file_move) {%>\n\t<span class="ui-icon move" id="move-<%= id %>"></span>\t\n\t<%}%>\n\t<span class="ui-icon"></span>\n\t<span class="text"><%= file %></span>\n\t<% if (settings) { %>\t\n\t<span class="toolbar">\n\t\t<span class="ui-icon preview" id="preview-<%= id %>"></span>\t\n\t\t<% if (settings.allow_file_delete) {%>\n\t\t<span class="ui-icon delete file" id="del-<%= id %>" title="delete file"></span>\t\n\t\t<%}%>\n\t</span>\n\t<%}%>\n</li>\n'}),define("text!templates/selected.tpl",[],function(){return'<li id="item-<%= id %>" class="row bb" >\n\t<div class="list-column-2">\n\t\t<label for="selected-<%= id %>">\n\t\t\t<a class="file-name" href="<%= src %>" target="_blanc"><%= file %></a>\n\t\t</label> \n\t\t<input id="selected-<%= id %>" type="hidden" name="fields[<%= fieldname %>][file][]" value="<%= path %>" readonly="readonly"/>\n\t</div>\n\t<div class="list-column-2">\n\t\t<span class="btn remove last" id="remove-<%= id %>">Ã—</span>\n\t</div>\n</li>\n'}),define("text!templates/upload.tpl",[],function(){return'<label>Uploads</label>\n<ul class="list-container uplaods" id="uploads-<%= id %>">\n\n</ul>\n'}),define("text!templates/upload_list.tpl",[],function(){return'<% var breadcrump = path.split(\'/\'); breadcrump.shift(); breadcrump = breadcrump.join(\' > \'); %>\n<li id="upload-<%= id %>">\n<div class="breadcrump list-row note"><%= breadcrump %></div>\n<div class="list-header bb bt">\n\t<div class="list-column-2">\n\t\t<div class="list-column-2">\n\t\t\t<div class="inner">\n\t\t\t\t<span class="button btn add">\n\t\t\t\t\t<input type="file" name="file[]" value="" multiple="multiple"/>\n\t\t\t\t</span>\t\n\t\t\t\t<span class="button btn remove disabled">\n\t\t\t\t</span>\t\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="list-column-2">\n\t\t\t<div class="inner">\n\t\t\t\t<span class="button btn start disabled">\n\t\t\t\t</span>\t\n\t\t\t\t<span class="button btn cancel disabled">\n\t\t\t\t</span>\t\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class="list-column-2">\n\t\t<div class="inner">\n\t\t\t<div class="list-column-1">\n\t\t\t\t<span class="button btn close last"></span>\n\t\t\t</div>\t\n\t\t</div>\n\t</div>\n</div>\n<ul class="list-container" id="upload-container-<%= id %>">\n\t<li class="hidden">\n\t\t<input type="hidden" name="destination" value="<%= destination %>"/>\n\t</li>\n</ul>\n</li>\n'}),define("text!templates/upload_list_item.tpl",[],function(){return'<li class="file-list list-row row bb" id="send-<%= id %>">\n\t<div class="list-column-4">\n\t\t<div class="inner">\n\t\t\t<span class="file-name">\n\t\t\t\t<% if (file === \'ok\') { %>\n\t\t\t\t<a class="success" href="<%= src %>" ><%= name %></a>\n\t\t\t\t<% } %>\n\t\t\t\t<% if (file !== \'ok\') { %>\n\t\t\t\t<%= name %>\n\t\t\t\t<% } %>\n\t\t\t</span>\n\t\t</div>\n\t</div>\n\t<div class="list-column-4">\n\t\t<div class="inner">\n\t\t\t<small class="file-size note"><%= size %></small>\n\t\t</div>\n\t</div>\n\t<div class="list-column-4">\n\t\t<div class="list-column-2">\n\t\t\t<div class="inner">\n\t\t\t\t<canvas width="36" height="36" class="progress last"></canvas>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="list-column-2">\n\t\t\t<div class="inner">\n\t\t\t\t<span class="progress-text note"></span>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class="list-column-4">\n\t\t<div class="inner">\n\t\t\t<span class="btn small remove last">remove</span>\n\t\t\t<span class="btn small cancel disabled last">cancel</span>\n\t\t\t<span class="btn small start last">start</span>\n\t\t</div>\n\t</div>\n</li>\n\n'}),define("text!templates/meta.tpl",[],function(){return'<div class="wrapper">\n\t<div class="row bb">\n\t\t<div class="list-column-1">\n\t\t\t<span class="btn small last close"></span>\n\t\t</div>\n\t</div>\n\t<div class="outer">\n\t\t<div class="row bt">\n\t\t\t<div class="list-column-4">\n\t\t\t\t<div class="preview-img">\n\t\t\t\t\t<img src="<%= preview %>"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="list-column-43">\n\t\t\t\t<div class="inner">\n\t\t\t\t\t<table class="small">\n\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td class="name">name</td>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<%= file %>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr class="bt">\n\t\t\t\t\t\t\t\t<td class="name">type</td>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<%= type %>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr class="bt">\n\t\t\t\t\t\t\t\t<td class="name">size</td>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<%= size %>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr class="bt">\n\t\t\t\t\t\t\t\t<td class="name">last modified</td>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<%= lastmod %>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</tbody>\t\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n'}),function(a){a("templates/_templates",["underscore","text!templates/dirtree.tpl","text!templates/dirs.tpl","text!templates/newdir.tpl","text!templates/files.tpl","text!templates/selected.tpl","text!templates/upload.tpl","text!templates/upload_list.tpl","text!templates/upload_list_item.tpl","text!templates/meta.tpl"],function(a,b,c,d,e,f,g,h,i,j){var k={};return{dirtree:a.template(b),dirs:a.template(c),newdir:a.template(d),files:a.template(e),selected:a.template(f),upload:a.template(g),upload_list:a.template(h),upload_list_item:a.template(i),meta:a.template(j)}})}(this.define),function(a,b,c,d){b("views/view_upload",["jquery","underscore","backbone","collections/col_upload","modules/mod_animate_circle","modules/mod_sysmessage","templates/_templates"],function(a,b,c,d,e,f,g){var h=c.View.extend.call(function(){this.initialize.apply(this,arguments)},c.Events);h.extend=c.View.extend;var i=function(){},j=h.extend({initialize:function(){this.observable={},this.observable.children=[],this._callback=b.bind(i,this)},register:function(a,b){this.observable.parent=a,this.observable.children=b},listen:function(a){var c=this;this.on("condition",function(){b.each(c.observable._diff,function(b){b.on(a,c._callback)})})},condition:function(a){var c=this;this.observable.parent.on(a,function(){c.observable._diff=b.difference(c.observable.children,c.observable._diff),c.trigger("condition")})},setState:function(){}}),k=c.View.extend({events:{"click .send":"submit"},initialize:function(){this.collection=d.addList(),this.collection.field_id=this.options.field_id,this.collection.on("create",b.bind(this.add,this)),this._ulQueue=[]},add:function(b){var c=b.toJSON(),d;c.destination=this.options.destination,d=a(g.upload_list_item(c)),b.set("context",d),b.set("field_id",52),this.$el.append(d),d.data("circle",new e({canvas:d.find(".progress")[0],lineWidth:2,stepTime:400})),this._ulQueue.push(d)},createItem:function(a,b){this.collection.addItem(b)},_flushUlQueue:function(a){if(b.isFunction(a))while(this._ulQueue.length)a.call(this._ulQueue.pop());else this._ulQueue=[]},_flushUlItem:function(a){var c=b.indexOf(this._ulQueue,a);c>=0&&this._ulQueue.splice(c,1)},submitAll:function(){this._flushUlQueue(function(a){this.find(".send").trigger("click")})},submit:function(c){c.preventDefault();var d=a(c.target).parents().filter("tr"),e=d[0].id.split("send-")[1],f=this.collection.get(e);f.on("progress",b.bind(this.progress,this,f.get("context").data("circle"))),this.collection.send(e),this._flushUlItem(f.get("context"))},progress:function(a,b){a.animate(b)}}),l=function(){function l(a){this.trigger("remove",a),this.$el.remove()}function k(){var a=this.$el.data();setTimeout(function(){a.progressIndicator.clearAnimation(),a.progressIndicator.drawFullCircle([255,0,0])},250)}function j(){var a=this.$el.data();this.trigger("success",this.model,this._upld.resolve()),a.progressIndicator.drawFullCircle(a.progressIndicator.settings.endColor),a.progressValue.html("100&#160;%")}function i(a,b){a.progressIndicator.animate(b||0),a.progressValue.html(b?b+"&#160;%":"")}function h(){var a="."+b.toArray(arguments).join(", .");this.$el.find(a).toggleClass("disabled")}function f(){var a=g.upload_list_item(this.model.toJSON());this.undelegateEvents(),this.setElement(a)}function d(a){return new e({canvas:a,lineWidth:6,stepTime:250})}return c.View.extend({events:{"click.item .remove":"remove","click.item .start:not(.disabled)":"submit","click.item .cancel:not(.disabled)":"cancel"},initialize:function(){var c=this.model;this.model.on("change:file",b.bind(this.update,this)),this.model.on("success",b.bind(j,this)),this.model.on("error",b.bind(k,this)),this.model.on("destroyed",b.bind(l,this)),this._upld=a.Deferred()},update:function(a){var b=this.$el.find(".file-name");this.$el.addClass("success"),h.call(this,"cancel")},render:function(){this._parent=this.$el,f.call(this),this.$el.data("progress-indicator",d(this.$el.find(".progress")[0])),this.$el.data("progress-value",this.$el.find(".progress-text")),this.model.set("context",this._parent),this._parent.append(this.$el)},submit:function(a){a.stopPropagation(),a.preventDefault(),this.$el.data(""),this.model.on("progress",b.bind(i,this,this.$el.data())),this.trigger("upload",this.model,this._upld.promise()),h.call(this,"cancel","start")},cancel:function(a){a.stopPropagation(),a.preventDefault(),this.trigger("cancel",this.model,this._upld.reject()),h.call(this,"cancel","start"),i.call(this,this.$el.data(),0)},remove:function(a){a.stopPropagation(),a.preventDefault(),this.cancel(a),this.model.collection.remove(this.model)}})}(),m=function(){function r(){}function q(){}function p(a){var c=this,d=a.split(" "),e=this.collection,f=function(){var a={};b.each(d,function(b){a[b]=c.$el.find("."+b)});return a}();e.on("flush push",function(){e.models.length?f.remove.removeClass("disabled"):f.remove.addClass("disabled"),e.hasPendingUploads()?f.start.removeClass("disabled"):f.start.addClass("disabled"),e.hasActiveUploads()?f.cancel.removeClass("disabled"):f.cancel.addClass("disabled")})}function o(){this.trigger("fileuploaded")}function n(a,b){this.collection.cancel(b.id)&&(this._ulQueue.push(a),this.trigger("cancel"))}function m(a){this.collection.send(a.id).fail(function(a){new f(null,a)}),this.trigger("start")}function k(b){var c=a(b.target),d=c.clone();i(d),c.after(d),c.detach(),this.collection.addItem(c)}function j(a){this._ulQueue.push(a)}function i(b){var c=a("<form/>").append(b);c[0].reset();return b}function h(a){var c=b.indexOf(this._ulQueue,a);c>=0&&(this._ulQueue.splice(c,1),this.trigger("flushed"))}function e(a,c){if(b.isFunction(a))while(this._ulQueue.length)a.call(this._ulQueue.pop());else this._ulQueue=[];b.isFunction(c)&&c()}return c.View.extend({events:{"click .cancel:not(.small):not(.disabled)":"cancelAll","click .remove:not(.small):not(.disabled)":"removeAll","click .start:not(.small):not(.disabled)":"submitAll","click .close":"close","change input[type=file]":k},initialize:function(){this.collection=d.addList(),this.collection.on("create",b.bind(this.add,this)).on("invalidtype",b.bind(q,this)).on("filesizeexceeds",b.bind(r,this)),this._ulQueue=[]},render:function(c){var d=g.upload_list(b.extend(c.toJSON(),{destination:this.options.destination}));this._parent=this.$el,this.undelegateEvents(),this.setElement(d,!0),this._parent.append(this.el),this._listcontainer=a("#upload-container-"+c.id),p.call(this,"remove start cancel")},add:function(a){var c;a.set("field_id",this.options.field_id),c=new l({model:a,el:this._listcontainer||"#upload-container-"+a.id}),c.render(),this._ulQueue.push(c),a.on("success",b.bind(h,this,c)).on("success",b.bind(o,this,c)),c.on("cancel",b.bind(n,this,c)),c.on("upload",b.bind(h,this,c)),c.on("upload",b.bind(m,this)),this.trigger("add")},cancelAll:function(){this.$el.find(".file-list .cancel").trigger("click.item")},submitAll:function(){e.call(this,function(a){this.$el.find(".start").trigger("click.item")})},removeAll:function(){var a=this;this.collection.remove(this.collection.models)},close:function(a){a.stopPropagation(),a.preventDefault(),this.$el.remove(),this.trigger("remove")}})}(),n=c.View.extend({events:{"click .start-all":"start"},initialize:function(){this.files=[],this.collection=d,this.uploadList={},this._dirinstance=[]},toggleView:function(){this.$el.slideDown()},addUpload:function(a){var c=new m({el:"#uploads-"+this.cid,className:"row item upload-container",field_id:this.options.field_id,destination:a.get("path")}),d=this;c.render(a),c.on("remove",b.bind(this.collection.remove,this.collection,a.id)),c.on("remove",function(){d.collection.models.length||d.$el.slideUp()}),c.on("fileuploaded",b.bind(function(){d.trigger("fileuploaded",a)}))},render:function(){if(this._rendered)return!0;this.el.innerHTML=g.upload({id:this.cid}),this._rendered=!0},removeItem:function(){},start:function(){this.uploadList.submitAll()},createUpload:function(a){if(this.collection.get(a.id))return!1;if(this._rendered===!0)this.collection.add(a),this.addUpload(a),this.trigger("uploadcreate",a);else{this.render(),this.createUpload(a);return}this.toggleView()}});return n})}(this.Symphony,this.define,this),function(a,b){a("collections/col_directories",["jquery","underscore","backbone","collections/col_general"],function(a,c,d,e){var f={},g,h,i,j;g=d.Model.extend({initialize:function(){this.set({id:c.uniqueId()},{silent:!0})}}),h=d.Collection.extend({parse:function(a){return a},model:g}),i=function(){function i(a,b){var d;b===this&&(d=this.get("files"),d&&d.remove(d.models),this.get("subdirs")&&c.each(this.get("subdirs"),function(b){g.call(b,!1,a)}))}function g(a,b){b=this.collection||b,b.remove(this,{silent:a})}function f(){var a=this.get("parent");!a||a.get("subdirs").push(this),this.collection.off("add reset",this._setSub),delete this._setSub}function e(){var a;!this.get("_parent")||(a=this.collection.get(this.get("_parent")),this.set("parent",a)),this.collection.off("add reset",this._setParent),delete this._setParent}function b(a,b){a.set("level",b&&b.get("level")+1||0)}function a(){this.collection.setSchemeState(this)}return d.Model.extend({defaults:{name:"",_parent:null,path:null,state:"close"},initialize:function(){var b=this;this._setParent=c.bind(e,this),this._setSub=c.bind(f,this),this.collection.on("add reset",this._setParent),this.collection.on("add reset",this._setSub),this.collection.on("remove",c.bind(i,this,this.collection)),this.on("change:state",c.bind(a,this)),this.set("state",this.collection.getSchemeStateByPath(this))},parse:function(a){a.files&&c.isArray(a.files)&&(a.files=new h(a.files));return a}})}(),j=function(){function k(a){return!!f[a]}function j(a,b){var c;b.directory._parent=a.get("_parent"),b.directory.id=a.id,this.remove(a,{silent:!0}),c=this.parse(b),this.add(c,{parse:!0})}function h(b,d){d=d||{},d.success=d.success||function(){},d.error=d.error||function(){};return a.ajax({type:"GET",url:this.url,dataType:"json",data:c.extend({field_id:this.settings.field_id},b),success:d.success,error:d.error})}function g(a,b,d){var e=this,f,h;if(a.directory)return g.call(this,a.directory,b);f=a.id?a.id:"dir"+c.uniqueId(),a._parent=a._parent,a.id=f,b.push(a);if(a.subdirs)while(a.subdirs.length)h=a.subdirs.shift(),h.directory._parent=f,g.call(this,h,b);return b}function d(){var a;f[this.cid]||(a=f[this.cid]={},c.each(this.models,function(b){a[b.get("path")]={state:"close"}}))}return e.extend({url:b.WEBSITE+"/symphony/extension/filemanager/listing/",model:i,initialize:function(){this.cid=this.cid||"c"+c.uniqueId()},populate:function(){this.deferred=this.fetch({data:{field_id:this.settings.field_id||0}}),this.deferred.done(c.bind(d,this))},parse:function(a){return g.call(this,a,[])},setScheme:function(a){f[this.cid]=a;return this},changeScheme:function(){k(this.cid)||d.call(this)},setSchemeState:function(a,b){f[this.cid][a.get("path")].state=a.get("state")?a.get("state"):"close"},getSchemeStateByPath:function(a){return k(this.cid)&&f[this.cid][a.get("path")]?f[this.cid][a.get("path")].state:"close"},getFile:function(a,b){var d=this.getFiles(b),e;if(!c.isArray(d))return d.get(a);e=c.find(d,function(b){return b.get(a)});return e},getFiles:function(a){return a?this.get(a).get("files"):this.pluck("files")},getFileById:function(a){a=parseInt(a,10);var b=this.getFiles(),d=c.find(b,function(b){return b.get(a)});return d.get(a)},getByFileName:function(a){var b=this.getFiles(),d=[];c.isArray(a)||(a=a.split(" ")),c.each(b,function(b){if(b){var e=c.filter(b.models,function(b){return c.include(a,b.attributes.path)});e.length&&d.push(e)}});return c.flatten(d)},updateDir:function(a){h.call(this,{select:a.get("path")}).done(c.bind(j,this,a)).fail()},createDir:function(b,d){d=this.get(d.id)||undefined;if(!d)return!1;var e=this.url.replace(/listing\/$/,"edit/"),f={mkdir:b,"in":d.get("path"),type:"create"};return a.ajax({url:e,type:"post",data:f,dataType:"json",success:c.bind(this.updateDir,this,d)})},moveItem:function(b){var c=this,d=this.get(b.source),e=this.get(b.destination),f=b.file?this.getFile(b.file,d.id):d,g={from:f.get("path"),to:e.get("path"),type:"move",dataType:b.type},h=this.url.replace(/listing\/$/,"edit/");return a.ajax({url:h,type:"post",data:g,dataType:"json",success:function(){b.type==="file"?(f.collection.remove(f),c.updateDir(d)):c.remove(d),c.updateDir(e)},error:function(){}})},deleteItem:function(b,c){var d=this.url.replace(/listing\/$/,"edit/"),e=this;return a.ajax({url:d,type:"post",data:{type:"delete",file:b.get("path")},dataType:"json",success:function(){c!=="file"?e.remove(b):b.collection.remove(b),e.trigger("itemdelete",b.get("id"),c)},error:function(){}})}})}();return j})}(this.define,this.Symphony),function(a,b,c){c("views/view_directories",["jquery","underscore","backbone","collections/col_directories","templates/_templates","modules/mod_sysmessage","modules/mod_byteconverter"],function(a,c,d,e,f,g,h){function m(a,c){b.Message.fade("silence",0),b.Message.post(a,c),b.Message.fade("silence",4e3),b.Message.timer()}var i,j,k,l;k=function(){function g(){var a=b.Context.get("root"),c=/image\/.*/.test(this.model.get("type"))?"/image/1/0/150"+this.model.get("src").substr((a+"/workspace").length):"/extensions/filemanager/assets/images/file-preview.png";return a+c}function e(a){a.preventDefault(),a.stopPropagation(),this.close()}return d.View.extend({events:{"click.meta .close":e},initialize:function(){this._rendered=!1,this.$el.on("destroyed",c.bind(this.remove,this))},render:function(){var a,b;if(this._rendered)return this;a=c.extend(this.model.toJSON(),{preview:g.call(this),size:h(this.model.get("size"))+" ("+this.model.get("size")+")"}),b=f.meta(a),this.el.innerHTML=b,this._rendered=!0;return this},open:function(){if(!this._rendered){this.render(),this.open();return this}this.$el.insertAfter(a("#file-"+this.options.parentView.model.id)),this.delegateEvents(),this.$el.slideDown();return this},close:function(a){var b=this;this.$el.slideUp(function(){a?b.$el.remove():(b.$el.detach(),b.undelegateEvents())})},remove:function(){this.undelegateEvents(),this.trigger("remove")}})}(),k.makeView=function(){if(this instanceof d.View)return new k({parentView:this,tagName:"li",model:this.model,id:"meta-for-"+this.model.id,className:"meta-view",idPrefix:"meta-for-"});throw"makeView called with wrong context"},i=function(){function a(a){a===this.model&&this._metaView&&this._metaView.close(!0)}return d.View.extend({initialize:function(){this.model.collection.on("remove",c.bind(a,this))},render:function(a){a=a||{};var b=this,d=f.files(c.extend(this.model.toJSON(),{settings:a}));this.el.innerHTML+=d,setTimeout(function(){b.$el.find("#preview-"+b.model.id).on("click.file",c.bind(b.showMetaInfo,b))},0)},showMetaInfo:function(a){a.preventDefault(),a.stopPropagation(),this._metaView||(this._metaView=k.makeView.call(this)),this._metaView.open()}})}(),j=function(){function g(){var b={},d=this.$el.find(".toolbar:first");c.each(a,function(a){var c=d.find("."+a);c.length&&(b[a]=c)}),this._tasks=b}function e(a,b){this._tasks[a]&&this._tasks[a].addClass("disabled")}function b(a,b){this._tasks[a]&&this._tasks[a].removeClass("disabled")}var a="upload create move delete".split(" ");return d.View.extend({events:{},initialize:function(){var a=this;this.fileViews=[],this.on("enabletask",c.bind(b,this)).on("disabletask",c.bind(e,this))},render:function(a,b,d){var e=this,h=c.clone(a),j,k=this.model.get("parent"),l=this.model.get("files"),m;this.$el.html(f.dirs(c.extend(this.model.toJSON(),{settings:c.extend(h,b)}))),m=this.$el.find("#sub-"+this.model.id),l&&(l.on("remove",c.bind(e.model.collection.trigger,e.model.collection,"remove")),l.each(function(a){var c=new i({el:m,model:a});e.fileViews.push(c),c.render(b)})),j=k?document.getElementById("sub-"+k.id):document.getElementById("dir-list-root"),j&&!d&&this.$el.appendTo(j),g.call(this),this.model.get("state")==="open"&&this.$el.addClass(this.model.get("state"))}})}(),l=function(){function u(){this.$el.find(".draggable:not(.ui-draggable)").trigger("mouseenter").end().find(".droppable:not(.ui-droppable)").trigger("mouseenter")}function t(){var a=this.$el.find(".droppable:not(.ui-droppable)");a.droppable({drop:c.bind(n,this),greedy:!0,tolerance:"intersect",hoverClass:"dropover",scope:"moveable"}),a.on("destroyed",r);return this}function s(){var a=this.$el.find(".draggable:not(.ui-draggable)");a.draggable({revert:!0,revertDuration:120,cursor:"move",axis:"y",handle:".move",opacity:.7,snap:!0,zIndex:2700,scope:"moveable"}),a.on("destroyed",q);return this}function r(){a(this).droppable("destroy")}function q(){a(this).draggable("destroy")}function p(b){b.preventDefault(),b.stopPropagation();var d;if(!!/droppable/.test(b.target.className)){d=a(b.target).add(".droppable"),d.droppable({drop:c.bind(n,this),greedy:!0,tolerance:"intersect",hoverClass:"dropover",scope:"moveable"});return this}}function o(b){b.preventDefault(),b.stopPropagation();var c;if(!!/draggable/.test(b.target.className)){c=a(b.target),c.draggable({revert:!0,revertDuration:120,cursor:"move",axis:"y",handle:".move",opacity:.7,snap:!0,zIndex:2700,scope:"moveable"});return this}}function n(b,c){b.preventDefault(),b.stopPropagation();var d=c.draggable,e=/file-/.test(d[0].className)?"file":"dir",f=a(b.target).parent()[0].id,g=e==="file"?d.parents().filter("li.dir")[0].id:d.parent()[0].id,h=e==="file"?d[0].id.substr(5):undefined;this.collection.moveItem({type:e,destination:f,source:g,file:h})}function m(a){a=a instanceof d.Model?a:this.collection.get(a.directory.id);return this.renderPart(a)}function l(a,b){var c=b.find("input[type=text]").val();this.collection.createDir(c,a).always(function(){b.off("click",".confirm"),b.remove()}).always(function(a){var b=new g(null,a)})}function k(a){var b=/dir/.test(a.id);b||this.trigger("select","remove",a.toJSON());return i.call(this,a.id,b?"dir":"file")}function i(b,c){if(!this instanceof d.View)throw"function called with wrong context";var e=c==="file"?a("#file-"+b):a("#"+b),f=a([e,e.find(".dir-header")]).filter(function(){return this.data("draggable")||this.data("droppable")});this.dirViews[b]&&delete this.dirViews[b],e.detach(),setTimeout(function(){e.remove()},100);return this}function h(b,c){var d=a(b.target),e=d.parent();c==="add"?e.addClass("selected"):c==="remove"&&e.removeClass("selected"),this.trigger("select",c,this.getFile(e).toJSON())}return d.View.extend({events:{"click.dritree .toolbar":"tasks","click.dirtree .dir-header":"toggleDir","click.dirtree .file:not(.selected) > .text":"select","click.dirtree .file.selected > .text":"unselect","click.dirtree .file > .toolbar > .delete":"deleteFile","click.dirtree .dir-header > .toolbar > .delete":"deleteDir","click.dirtree .dir-header > .toolbar > .create":"createDir"},initialize:function(){this.collection=new e,this.collection.addSetting("field_id",this.options.field_id),this.collection.populate(),this.collection.deferred.done(c.bind(this.render,this)),this.collection.on("add",c.bind(this.renderPart,this)),this.collection.on("remove",c.bind(k,this))},tasks:function(b){var c=a(b.target).parents().filter("li").find("ul")[0].id.substr(4),d=b.target.className.split(" ")[1];this.trigger(d,this.collection.get(c));return!1},select:function(a){h.call(this,a,"add")},unselect:function(a){h.call(this,a,"remove")},selectById:function(a){this.filesById(a).addClass("selected");return this},unselectById:function(a){this.filesById(a).removeClass("selected");return this},filesById:function(a){return this.$el.find(c.isArray(a)?"#file-"+a.join(", #file-"):"#file-"+a)},getFile:function(a){var b=a.parent()[0].id.substr(4);return this.collection.getFile(a[0].id.split("file-")[1],b)},confirm:function(a){return confirm(a)},deleteDir:function(c){var d=this.collection.get(a(c.target).parents().filter(".dir")[0].id),e=b.Language.get(g.confirm_directory_deletion,{dir:d.get("name"),dir2:d.get("name"),dircount:d.get("subdirs")?d.get("subdirs").length:0,filecount:d.get("files")?d.get("files").models.length:0});this.confirm(e)&&this.collection.deleteItem(d,"dir")},deleteFile:function(c){var d=a(c.target),e=d.parents().filter(".file"),f=e.parent(),h=this.getFile(e),i=b.Language.get(g.confirm_file_deletion,{file:"test"});this.confirm(i)&&this.collection.deleteItem(h,"file")},createDir:function(b){var d=a(b.target),e=this.collection.get(d.parents().filter(".dir")[0].id),g=a(f.newdir({parent:e.get("path"),level:~~e.get("level")+1}));a("#sub-"+e.id).prepend(g),this.openDir(d.parents().filter(".dir")),g.on("click",".add",c.bind(l,this,e,g)),g.on("click",".cancel",function(){g.remove()})},toggleDir:function(b){var c,d,e,f,e;b.preventDefault(),b.stopPropagation(),c=a(b.target).parents().filter(".dir:not(#dir-list-root)").first(),d=c.find("> .sub-dir"),f=c.hasClass("open")?"close":"open",e=f==="open"?"openDir":"closeDir",this[e](c)},openDir:function(a){a.find("> .sub-dir").slideDown(),a.addClass("open"),this.collection.get(a[0].id).set("state","open")},closeDir:function(a){a.find("> .sub-dir").slideUp(),a.removeClass("open"),this.collection.get(a[0].id).set("state","close")},enableTask:function(a,b){this.dirViews[b.id].trigger("enabletask",a)},disableTask:function(a,b){this.dirViews[b.id].trigger("disabletask",a)},renderPart:function(a){var b,d=this.dirViews[a.id]?!0:!1;d?(b=this.dirViews[a.id],b.model=a):(b=new j({tagName:"li",id:a.id,className:"dir level-"+a.get("level"),model:a}),this.dirViews[a.id]=b),b.render(this.options.dirSettings,this.options.fileSettings,d),d&&c.isArray(a.get("subdirs"))&&c.each(a.get("subdirs"),c.bind(m,this)),d&&this.trigger("update"),s.call(this),t.call(this)},render:function(a){var b=this;this.dirViews={},this.el.innerHTML=f.dirtree({name:this.options.baseName}),this.collection.each(c.bind(this.renderPart,this))}})}();return l})}(this,this.Symphony,this.define),function(a){a("collections/col_select",["underscore","collections/col_general"],function(a,b){function e(){var a=c[this.cid];a.push((new Date).getTime())}var c={},d=b.prototype.constructor.prototype.add,f=b.extend({initialize:function(){this.cid="c"+a.uniqueId(),c[this.cid]=[],this.on("add remove",a.bind(e,this))},add:function(b){var c=a.isArray(b)?b.length:1,e=this.models.length+c,f;if(this.settings.limit&&e>this.settings.limit){f=a.isArray(b)?a.pluck(b,"id"):b.id,this.trigger("selectionlimitexceed",f);return!1}d.apply(this,arguments)},hasChanges:function(){return!!c[this.cid].length}});return f})}(this.define),function(a){a("views/view_select",["jquery","underscore","backbone","collections/col_select","modules/mod_sysmessage","templates/_templates"],function(a,b,c,d,e,f){function g(){var a={error:{message:e.file_select_limit_exceed,context:{count:this.collection.settings.limit}}};return new e("error",a,!1)}var h=c.View.extend({events:{"click .remove":"removeFromList"},initialize:function(){this.collection=new d,this.dirtree=this.options.dirtree,this.fieldname=this.options.fieldname,this.dirtree.on("select",b.bind(this.update,this)),this.collection.on("add",b.bind(this.addItem,this)).on("remove",b.bind(this.removeItem,this)),this.collection.on("selectionlimitexceed",b.bind(g,this)),this.prePopulate()},prePopulate:function(){var a=this,b=this.$el.find(".file-selected input[type=hidden]"),c=[],d=[];b.each(function(){c.push(this.value)}),d=this.dirtree.collection.deferred.done(function(){var b=a.dirtree.collection.getByFileName(c);a.collection.add(b,{silent:!0}),a.render(),a.trigger("prepoulate",a.collection.pluck("id"))})},getFiles:function(){return this.collection.pluck("path")},render:function(){var a=this,c="",d=f.selected;this.collection.each(function(e){e=e.toJSON(),b.extend(e,{fieldname:a.fieldname}),c+=d(e)}),this.el.innerHTML=c},addItem:function(a){a=a.toJSON(),a.fieldname=this.fieldname;var b=a.id,c=f.selected(a);this.$el.append(c)},removeFromList:function(a){var b=parseInt(a.target.id.split("remove-")[1],10);this.removeItem(this.collection.get(b))&&this.trigger("removedselected",b)},removeItem:function(b){var c=b.id,d=a("#item-"+b.id);if(this.collection.remove(c)){d.remove();return!0}return!1},update:function(a,b){switch(a){case"add":this.collection.add(b);break;case"remove":this.collection.remove(b)}}});return h})}(this.define),function(a,b){typeof a=="function"&&a.amd?a("plugins/jquery-event-destroyed",["jquery"],b):b(this.jQuery)}(this.define,function(a){var b=jQuery.cleanData;a.cleanData=function(c){for(var d=0,e;(e=c[d])!==undefined;d++)a(e).triggerHandler("destroyed");b(c)}}),function(a,b,c){function d(a){return a.replace(/(\s+)(.)/g,function(a,b,c){return"-"+c}).toLowerCase()}var e=jQuery;c(["jquery","underscore","backbone","views/view_upload","views/view_directories","views/view_select","modules/mod_sysmessage","jqueryui","plugins/jquery-event-destroyed"],function(a,c,d,f,g,h,i){window.jQuery=e,e=null,a.noConflict(),d.noConflict(),c.noConflict();var j=a;d.emulateHTTP=!0;var k=b.Context.get("root")+"/symphony/extension/filemanager/settings/",l=b.Context.get("root")+"/symphony/extension/filemanager/upload/",m=d.Model.extend({url:k,initialize:function(){this.deferred=this.fetch({data:{field_id:j("#filemanager").find('input[name="fields[field_id]"]').val()}})}}),n=new m;j(function(){function k(){var b=a.serialize();j.ajax({type:"POST",url:a.attr("action"),data:b})}var a=j("form"),d=j("#filemanager-container"),e=j("#filemanager");e.addClass("loading"),a.submit(function(){j(window).off("beforeunload")});var m=parseInt(j("input[name=MAX_FILE_SIZE]").val(),10);n.deferred.done(function(n){var o={},p={};c.each(n,function(a,b){b.match(/^allow_file_.*/)&&(o[b]=a),b.match(/^allow_dir_.*/)&&(p[b]=a)});var q=new g({el:"#filemanager-dir-listing-body",tagName:"ul",className:"root-dir dir",dirSettings:p,fileSettings:o,field_id:n.field_id,baseName:n.element_name});n.allow_dir_move&&q.$el.addClass("draggable");var r=j("#filemanager-files-select-container"),s=n.element_name,t=new h({dirtree:q,el:r.find("ul").get(0),fieldname:s});n.limit_files&&t.collection.addSetting("limit",parseInt(n.limit_files,10));if(n.allow_dir_upload_files){var u=new f({el:"#filemanager-fileupload",field_id:n.field_id});u.collection.addSetting("allowed_types",n.allowed_types.split(" "),!0),u.collection.addSetting("max_file_size",n.max_upload_size||m),u.collection.addSetting("field_id",n.field_id),u.collection.url=l,u.on("uploadcreate",c.bind(q.disableTask,q,"upload")),u.on("uploaddestroy",c.bind(q.enableTask,q,"upload")),u.on("fileuploaded",c.bind(q.collection.updateDir,q.collection)),q.on("upload",c.bind(u.createUpload,u)).on("toggle",function(){})}window.selectView=t,window.dirTreeView=q,q.on("update",function(){setTimeout(function(){var a=t.collection.pluck("path"),b=q.collection.getByFileName(a),d=c.pluck(b,"id");q.selectById(d),t.collection.each(function(a){var b=q.collection.getByFileName(a.get("path"));b=b[0],b&&(a.set("id",b.id),a.id=b.id)}),t.render()},0)}),t.on("prepoulate",c.bind(q.selectById,q)),t.on("removedselected",c.bind(q.unselectById,q)),t.collection.on("selectionlimitexceed",c.bind(q.unselectById,q)),e.removeClass("loading"),d.slideDown(),j(window).on("beforeunload",function(){if(t.collection.hasChanges()){k(),a.submit();return b.Language.get(i.unsaved_changes)}})})})})}(this.jQuery,this.Symphony,this.require)